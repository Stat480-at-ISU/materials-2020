<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Working with  dates &amp; time</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../extras/x-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Working with <br>dates &amp; time

---




## deceptively tricky

At first glance, dates and times seem simple, but consider these questions:  

1. Does every year have 365 days?  

2. Does every day have 24 hours?  

3. Does every minute have 60 seconds? 

&lt;/br&gt;&lt;/br&gt;
Dates and times are hard because they have to reconcile:

- two physical phenomena (the rotation of the Earth and its orbit around &lt;br&gt;the sun)  

- a whole raft of geopolitical phenomena including months, time zones, &lt;br&gt;and daylight savings time.
???
I’m sure you know that not every year has 365 days, but do you know the full rule for determining if a year is a leap year? (It has three parts.) 

You might have remembered that many parts of the world use daylight savings time (DST), so that some days have 23 hours, and others have 25. 

You might not have known that some minutes have 61 seconds because every now and then leap seconds are added because the Earth’s rotation is gradually slowing down.

---
background-image: url(https://pbs.twimg.com/media/CEwVKWbWgAAzFS2.png)
background-size: 600px
background-position: 25% 65%

## Comprehensive map of all countries that use the &lt;br&gt;MM-DD-YYYY format

.footnote[
From [https://twitter.com/donohoe/status/597876118688026624](https://twitter.com/donohoe/status/597876118688026624).
]

---
background-image: url(https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/lubridate.png)
background-size: 120px
background-position: 92% 5%

## `lubridate` 

package for working with dates and times  

defines different classes of time: instants, periods, intervals, durations

defines converter and accessor functions, enables time calculations


.center[
&lt;img src="images/lubridate_ymd.png" height="400"&gt;
]
---
## date/time data

Three types of date/time data: dates, times, and date-times.  

- If you can use a date instead of a date-time, you should. (it's simpler)  

- Date-times are substantially more complicated because of the need to handle time zones.

---
## creating date/times
To get the current date or date-time you can use `today()` or `now()`:


```r
today()
```

```
## [1] "2020-03-26"
```

```r
now()
```

```
## [1] "2020-03-26 09:27:10 CDT"
```

&lt;/br&gt;&lt;/br&gt;
Otherwise, there are three ways you’re likely to create a date/time:

1. From a string.

2. From individual date-time components.

3. From an existing date/time object.


---
## Converter functions &amp; &lt;br&gt;instants in time

- time instants: one (absolute) moment in time, e.g. `now()`, `Jan-1-2000`  

- easy-to-use converter functions:  

    - date: `ymd()`, `mdy()`, `dmy()`, ...  
    
    - time: `hm()`, `hms()`, ...  
    
    - date &amp; time: `ymd_hms()`, `mdy_hm()`, ...  
    
- order of letters determines how strings are parsed  

- separators are automatically determined, then assumed to be the same  

???
- identify the order in which year, month, and day appear in your dates  

- arrange "y", "m", and "d" in the same order

- this will gives you the name of the lubridate function that will parse your date

---
## Converter function Examples



```r
ymd("2020-03-26")
```

```
## [1] "2020-03-26"
```

```r
mdy("03-26-2020")
```

```
## [1] "2020-03-26"
```

```r
mdy("March 26th, 2020")
```

```
## [1] "2020-03-26"
```

```r
ymd(20200326)
```

```
## [1] "2020-03-26"
```

---
## Converter function Examples


```r
mdy_hm("03/26/2020 09:00")
```

```
## [1] "2020-03-26 09:00:00 UTC"
```

You can also force the creation of a date-time from a date by supplying a timezone:


```r
ymd("2020-03-26", tz = "UTC")
```

```
## [1] "2020-03-26 UTC"
```

---
class: yourturn
# Your Turn

- Create date objects for today's date by typing the date in text format and converting it with one of the `lubridate` converter functions.   

- Try different formats of writing the date and compare the end results.  



---
## Accessor functions


- accessor functions: `year()`, `month()`, `week()`, `wday()`, `mday()`, `yday()`, `hour()`, `minute()`, ...  

- accessor functions can also be used for setting elements of date and time, e.g. `hour(x) &lt;- 12`  

&lt;br/&gt;
Examples:  


```r
month(now())
```

```
## [1] 3
```

```r
wday(now(), label = TRUE)
```

```
## [1] Thu
## Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat
```

---
## Intervals and Durations

- Intervals have a **start** and an **end** date/time: absolute difference  

- Durations are potentially of relative length (months, leap year, &lt;br&gt;leap second, ...)


```r
end_date &lt;- now()
# span is interval, years(1) is duration
span &lt;- end_date - years(1)
span
```

```
## [1] "2019-03-26 09:27:10 CDT"
```

```r
end_date - days(10)
```

```
## [1] "2020-03-16 09:27:10 CDT"
```

---
## Example: Movies


```r
library(classdata)
summary(box$Date) # date variable: allows date calculus
```

```
##         Min.      1st Qu.       Median         Mean      3rd Qu.         Max. 
## "2013-03-08" "2014-10-24" "2016-06-17" "2016-06-12" "2018-01-26" "2019-10-11"
```

---
## Example: Movies (cont'd)


```r
library(tidyverse)

box %&gt;% ggplot(aes(x = Date)) + geom_histogram(binwidth=7)
```

![](01_dates-and-time_files/figure-html/unnamed-chunk-8-1.png)&lt;!-- --&gt;

---
## Example: Movies (cont'd)

Is there a seasonal effect in the number of movies in the box office?


```r
library(lubridate)

box %&gt;% ggplot(aes(x = month(Date, label=TRUE))) + geom_bar()
```

![](01_dates-and-time_files/figure-html/unnamed-chunk-9-1.png)&lt;!-- --&gt;

---
class: yourturn
# Your Turn


- inspect the `budget` data set from the `classdata` package

- make sure the variable `Release Date` is a date format

- plot a histogram of the variable

- merge (`join`) budget and box office data (by movie name)  

- is the time between the release of a movie and the date is equal to the number of weeks in theaters?



---
## Resources

- reference/document: https://lubridate.tidyverse.org/index.html

- RStudio cheat sheet for [lubridate](https://rawgit.com/rstudio/cheatsheets/master/lubridate.pdf)

- Artwork by [@allison_horst](https://twitter.com/allison_horst?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "tomorrow",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
