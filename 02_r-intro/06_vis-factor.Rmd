---
title: "Visualizing factor variables"
ratio: 16x10
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: "../extras/x-theme.css"
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE, echo = TRUE)
#xaringan::inf_mr(cast_from = '..') 
# install_github("hadley/emo")
library(emo)
emo_warn <- emo::ji("warning")
```
class: inverse

## Visualizing factors 

<br/>

### Outline:

- Review: factors in bar charts & factors in boxplots  

- use factors in aesthetics (`colour`, `fill`, `shape`) or for facetting  

- always make sure that the order in factors is sensible!

---
## `r emo_warn` factors in boxplots `r emo_warn`

boxplots in ggplot2 only work properly if the x variable is a character variable or a factor:

```{r, echo=FALSE, warning=FALSE, message= FALSE}
library(ggplot2)
```

```{r, echo = TRUE}
twoyear <- dplyr::filter(gss_cat, year %in% c(2000, 2014))
```

.pull-left[
```{r, fig.width=3, fig.height = 3, message = FALSE, warning = FALSE, echo = TRUE}
ggplot(data = twoyear, 
       aes(x = year, y = tvhours)) + 
  geom_boxplot()
```
]
.pull-right[
```{r, fig.width=3, fig.height = 3, message = FALSE, warning = FALSE, echo = TRUE}
ggplot(data = twoyear, 
       aes(x = factor(year), y = tvhours)) + 
  geom_boxplot()
```
]

---
## `r emo_warn` factors in bar charts `r emo_warn`

A barchart can also provide us with a quick summary *provided* the <br> levels have values.

.pull-left[
```{r echo = TRUE}
ggplot(gss_cat, aes(race)) +
  geom_bar()
```
]

.pull-right[
```{r echo = TRUE}
ggplot(gss_cat, aes(race)) +
  geom_bar() +
  scale_x_discrete(drop = FALSE)
```
]

---
## Note: factors for fill color

In area plots (e.g. histograms & barcharts) use aesthetic `fill` for <br>showing colored areas.

 - In area plots, only factor variables can be mapped to `fill`

---
## Fill color example: 

```{r, message = FALSE, echo = TRUE, fig.height = 5.5, fig.width = 6}
ggplot(gss_cat, aes(x = marital, fill=year)) + 
  geom_bar() # nothing happens
```

---
## Fill color example: 


```{r echo = TRUE, fig.height = 5.5, fig.width = 7.1}
ggplot(gss_cat, aes(x = marital, fill=factor(year))) + 
  geom_bar() # not sensible, but works
```

---
## Ex: Survival on the Titanic

The object `titanic` is a table of a break down of survival of passengers and crew on board the Titanic by gender and age.

```{r, message = FALSE, echo = TRUE}
library(classdata)
data("Titanic", package = "classdata")
head(titanic)
```

---
## Barcharts of all variables

.pull-left[
```{r, fig.width=3, fig.height = 2, echo = TRUE}
ggplot(titanic, aes(x = Survived)) + 
  geom_bar()

ggplot(titanic, aes(x = Sex)) + 
  geom_bar()
```
]
.pull-right[
```{r, fig.width=3, fig.height = 2, echo = TRUE}
ggplot(titanic, aes(x = Class)) + 
  geom_bar()

ggplot(titanic, aes(x = Age)) + 
  geom_bar()
```
]

---
## `position="fill"`

.pull-left[
```{r, fig.width=3, fig.height = 2, echo = TRUE}
ggplot(titanic, aes(x = Survived, fill=Survived)) + 
  geom_bar(position="fill")

ggplot(titanic, aes(x = Sex, fill=Survived)) + 
  geom_bar(position="fill")
```
]
.pull-right[
```{r, fig.width=3, fig.height = 2, echo = TRUE}
ggplot(titanic, aes(x = Class, fill=Survived)) + 
  geom_bar(position="fill")

ggplot(titanic, aes(x = Age, fill=Survived)) + 
  geom_bar(position = "fill")
```
]

---
## Two and more factor variables

Besides facetting and position, use **mosaic plots**  

- there are extension packages for `ggplot2`, e.g. `ggmosaic`

---
## Mosaicplots

```{r, fig.width=10, fig.height = 4, message=FALSE, echo = TRUE}
library(ggmosaic)
ggplot(data = titanic)  + 
  geom_mosaic(aes(x = product(Sex), fill=Survived, weight=1)) +
  facet_grid(Age~Class)
```

---
class: yourturn
.center[
# Your turn 
]

For this your turn use the `titanic` object from the `classdata` package. 

- Draw a barchart of Gender. Interpret.

- Map survival to fill color in the barchart of Gender. Interpret.

- In the previous barchart change the `position` parameter to `"fill"`. Interpret.

- Read up on the `position` parameter in `?geom_bar`. Try out other options for `position`.

---
class: inverse, center, middle
# Why no pie charts?

---
background-image: url(https://miro.medium.com/max/1200/1*1IGNklnCANZPp2VD3mV9JQ.png)
background-size: 400px
background-position: 90% 40%
## Order of tasks - <br> easiest to hardest

.pull-left[
Cleveland and McGill (1984):

1. Position along a common scale
2. Positions along non-aligned scales
3. Length, direction, angle
6. Area
7. Volume, curvature
9. Shading, color saturation
]


---
## Implications for <br>drawing charts:  

- make main comparisons as easy as possible 
  - i.e. map as position along a common scale  
  
- Additional messages can be mapped on other aesthetics
