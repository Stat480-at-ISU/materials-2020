---
title: ""
ratio: 16x10
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: "../extras/x-theme.css"
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	cache = TRUE
)
```

```{r, echo=FALSE}
library(ggplot2)
library(ggsci)
library(ggthemes)
library(gridExtra)
library(grid)

grid_arrange_shared_legend <- function(..., ncol = length(list(...)), nrow = 1, position = c("bottom", "right")) {

  plots <- list(...)
  position <- match.arg(position)
  g <- ggplotGrob(plots[[1]] + theme(legend.position = position))$grobs
  legend <- g[[which(sapply(g, function(x) x$name) == "guide-box")]]
  lheight <- sum(legend$height)
  lwidth <- sum(legend$width)
  gl <- lapply(plots, function(x) x + theme(legend.position="none"))
  gl <- c(gl, ncol = ncol, nrow = nrow)

  combined <- switch(position,
                     "bottom" = arrangeGrob(do.call(arrangeGrob, gl),
                                            legend,
                                            ncol = 1,
                                            heights = unit.c(unit(1, "npc") - lheight, lheight)),
                     "right" = arrangeGrob(do.call(arrangeGrob, gl),
                                           legend,
                                           ncol = 2,
                                           widths = unit.c(unit(1, "npc") - lwidth, lwidth)))
  
  grid.newpage()
  grid.draw(combined)

  # return gtable invisibly
  invisible(combined)

}

```

class: title-slide, center, top
background-image: url(https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/ggplot2_masterpiece.png)
background-size: 650px
background-position: 50% 80%

# Polishing plots

---
## Color in ggplot2

There are many packages available for use that have color scheme options.


```{r, echo=FALSE, fig.height=7, fig.width=10}
library(ggsci)
library(viridis)
library(wesanderson)
library(RColorBrewer)

p1 = ggplot(data = mpg, aes(x = class, fill = class)) + geom_bar() +
  theme_bw() +theme(legend.position = "none")
p11<- p1 +labs(title= "ggplot2 default")
p2 = p1 + scale_fill_npg() + labs(title = "NPG")
p3 = p1 + scale_fill_startrek() + labs(title = "Star Trek")
p4 = p1 + scale_fill_ucscgb() + labs(title = "UCSCGB")
p5 = p1 + scale_fill_viridis(discrete = TRUE) + labs(title = "Viridis")
p6 = p1 + scale_fill_viridis(option="magma", discrete = TRUE) + labs(title = "Magma")
#p7 = p1 + scale_color_manual(values = wes_palette(4, "Rushmore")) + labs(title = "Rushmore")
#p8 = p1 + scale_color_manual(values = wes_palette(5, "Zissou")) + labs(title = "Zissou")
p9 = p1 + scale_fill_brewer(palette="Set2") + labs(title = "Set2")
p0 = p1 + scale_fill_brewer(palette="Dark2") + labs(title = "Dark2")

grid.arrange(p11, p2, p3, p4, p5, p6, #p7, p8, 
             p9, p0, nrow = 2)

```

---

## Built-In Themes

```{r, echo=FALSE, fig.height=7, fig.width=10, message=FALSE, warning=FALSE}

mtcars$gear <- factor(mtcars$gear)

p0 <- ggplot(mtcars, aes(x = wt, y = mpg, colour = gear)) + geom_point() 

p1 <- p0 + labs(title = "Default")
p2 <- p0 + theme_classic() + labs(title = "theme_classic")
p3 <- p0 + theme_bw() + labs(title = "theme_bw()")
p4 <- p0 + theme_dark() + labs(title = "theme_dark")
p5 <- p0 + theme_void() + labs(title = "theme_void")
p6 <- p0 + theme_minimal() + labs(title = "theme_minimal")

grid.arrange(p1, p2, p3, p4, p5, p6, nrow = 2)
```

---

## Other Themes: ggthemes a ggplot2 extension

```{r, echo=FALSE, fig.height=7, fig.width=10}
library(ggthemes)

# Economist theme
# A theme that approximates the style of plots in The Economist magazine.
p1 <- p0 + theme_economist() + scale_colour_economist() + labs(title = "Economist")
#p2 <- p0 + theme_stata() + scale_colour_stata()  + labs(title = "Stata")
p3 <- p0 + geom_smooth(method = "lm", se = FALSE) +
  scale_color_fivethirtyeight("cyl") +
  theme_fivethirtyeight() + labs(title = "FiveThirtyEight")
p4 <- p0 + theme_igray() + scale_colour_tableau()  + labs(title = "Tableau")
p5 <-p0 + geom_rangeframe() +
  theme_tufte() + 
  scale_x_continuous(breaks = extended_range_breaks()(mtcars$wt)) +
  scale_y_continuous(breaks = extended_range_breaks()(mtcars$mpg)) + labs(title = "Tufte")
p6 <- p0 + theme_wsj() + scale_colour_wsj("colors6", "") + labs(title = "Wall Street Journal")

 p7 <- p0 + 
  ggtitle("Highcharts") +
  theme_hc() +
  scale_colour_hc()

p8 <- p0 +
  ggtitle("Highcharts dark") +
  theme_hc(bgcolor = "darkunica") +
  scale_fill_hc("darkunica")

p9 <- p0 + theme_excel() + scale_colour_excel() + labs(title = "Excel 2003")


grid.arrange(p1, p0, p3, p4, p5, p6, p7, p8, p9, nrow = 3)
```



---

## Setting Themes

You can globally set a theme with the `theme_set()` function:

```{r, fig.width=9, fig.height=4}
theme_set(theme_minimal())

ggplot(data = iris, aes(x = Sepal.Width, y = Sepal.Length, color = Species)) +
  geom_point() + 
  scale_color_manual(values = c("turquoise3", "green3", "darkorchid2")) +
  theme(legend.position = "bottom")

```


---

## Elements in a theme

The function `theme()` is used to control non-data parts of the graph including:

- **Line elements**: axis lines, minor and major grid lines, plot panel border, axis ticks background color, etc.  
- **Text elements**: plot title, axis titles, legend title and text, axis tick mark labels, etc.  
- **Rectangle elements**: plot background, panel background, legend background, etc.  

There is a specific function to modify each of these three elements :

- `element_line()` to modify the line elements of the theme
- `element_text()` to modify the text elements
- `element_rect()` to change the appearance of the rectangle elements
- `element_blank()` to draw nothing and assign no space

**Note**: `rel()` is used to specify sizes relative to the parent, `margins()` is used to specify the margins of elements.

---


## Modifying a plot

```{r, fig.height=4, fig.width=10, eval = FALSE}
p1 <- ggplot(mpg) + 
  geom_bar(aes(x = class, colour = manufacturer, fill = manufacturer) ) 

p2 <- p1 + theme_classic() + theme(
  ## modify plot background
  plot.background = element_rect(fill = "lightskyblue1",colour = "pink",size = 0.5, linetype = "longdash")
  )
```


```{r, fig.height=4, fig.width=10, echo = FALSE}
p1 <- ggplot(mpg) + 
  geom_bar(aes(x = class, colour = manufacturer, fill = manufacturer) ) 

p2 <- p1 + theme_classic() + theme(
  ## modify plot background
  plot.background = element_rect(fill = "lightskyblue1",colour = "pink",size = 0.5, linetype = "longdash")
  )
grid.arrange(p1, p2, nrow = 1)
```

---

## Plot Legends

```{r, fig.height=4, fig.width=10}
p3 <- p2 + theme(
  ### move and modify legend 
  legend.title = element_blank(),
  legend.position = "top", 
  legend.key = element_rect(fill = "lightskyblue1", color = "lightskyblue1"),
  legend.background = element_rect( fill = "lightskyblue1",color = "pink", size = 0.5,linetype = "longdash")
  )
```


```{r, fig.height=4, fig.width=10, echo = FALSE}
grid.arrange(p2, p3, nrow = 1)
```

---

## Modifying Axes

```{r, echo=TRUE, fig.height=3.5, fig.width=10}
p4 <- p3 + theme(
  ### remove axis ticks
  axis.ticks=element_blank(),
  ### modify axis lines
  axis.line.y = element_line(colour = "pink", size = 1, linetype = "dashed"),
  axis.line.x = element_line(colour = "pink", size = 1.2, linetype = "dashed"))
```

```{r, echo=FALSE, fig.height=3.5, fig.width=10}
grid.arrange(p3, p4, nrow = 1)
```


---

## Plot Labels

Can be modified in several ways:
- `labs()`, `xlab()`, `ylab()`, `ggtitle()`
- You can also set axis and legend labels in the individual scales (using the first argument, the name)
.
```{r, echo=TRUE, fig.height=3.5, fig.width=10}
p5 <- p4 + labs(x = "Class of car", 
                y = "",
                title = "Cars by class and manufacturer",
                subtitle = "With a custom theme!!")
```

```{r, echo=FALSE, fig.height=3.5, fig.width=10}
grid.arrange(p4, p5, nrow = 1)
```

---

## Saving your Work

We can save the results of a plot to a file (as an image) using the `ggsave()` function:

```{r, eval=FALSE}
p1 <- ggplot(data = iris, aes(x = Sepal.Width, y = Sepal.Length, color = Species)) +
  geom_point() + 
  scale_color_manual(values = c("turquoise3", "green3", "darkorchid2")) +
  theme(legend.position = "bottom")

ggsave("iris-scatter.pdf", plot = p1)
```
